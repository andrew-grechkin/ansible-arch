---
- name: Install essential tools
  become: true
  community.general.packaging.os.pacman:
    name: [sudo, bash-completion, git, neovim, tmux, zsh, zsh-completions, iw, wireless-regdb, polkit]

- name: Install filesystem/partition tools
  become: true
  community.general.packaging.os.pacman:
    name:
      - btrfs-progs
      - dosfstools
      - exfat-utils
      - f2fs-tools
      - fuseiso
      - ntfs-3g
      - sshfs
      - udftools

- name: Install man/help
  become: true
  community.general.packaging.os.pacman:
    name: [man-db, man-pages]

- name: Install search tools
  become: true
  community.general.packaging.os.pacman:
    name: [ack, fd, fzf, ripgrep, the_silver_searcher, mlocate]

- name: Install boot tools
  become: true
  community.general.packaging.os.pacman:
    name: [efibootmgr, refind]

- name: Install hdd tools
  become: true
  community.general.packaging.os.pacman:
    name: [smartmontools, hdparm]
    # - hd-idle

- name: Enable hdd smart service
  become: true
  ansible.builtin.service:
    name: smartd
    enabled: true

- name: Install common tools
  become: true
  community.general.packaging.os.pacman:
    name:
      - acpi
      - exa
      - htop
      - hwinfo
      - iotop
      - lsb-release
      - lsof
      - strace
      - usbutils

- name: Install network tools
  become: true
  community.general.packaging.os.pacman:
    name: [inetutils, nss-mdns, nfs-utils, cifs-utils, socat, gnu-netcat, rsync]

- name: Install pacman tools
  become: true
  community.general.packaging.os.pacman:
    name: [pacman-contrib, pkgstats, reflector]

- name: Install perl base
  become: true
  community.general.packaging.os.pacman:
    name: [perl, perlbrew]

- name: Install perl additional
  become: true
  community.general.packaging.os.pacman:
    name:
      - perl-cpanel-json-xs
      - perl-data-dump
      - perl-datetime-timezone
      - perl-dbd-pg
      - perl-ev
      - perl-image-exiftool
      - perl-io-socket-ssl
      - perl-log-any
      - perl-path-tiny
      - perl-perl-critic
      - perl-rename
      - perl-role-tiny
      - perl-tidy
      - perl-yaml-libyaml

- name: Install python base
  become: true
  community.general.packaging.os.pacman:
    name:
      - python
      - python-neovim
      - python-pip
      - swig

- name: Install ansible
  become: true
  community.general.packaging.os.pacman:
    name:
      - ansible

- name: Install file management tools
  become: true
  community.general.packaging.os.pacman:
    name:
      - cpio
      - inotify-tools
      - jq
      - lzop
      - ncdu
      - p7zip
      - pigz
      - progress
      - pv
      - unrar
      - unzip
      - vifm

- name: Install barcode/qrcode tools
  become: true
  community.general.packaging.os.pacman:
    name: [zbar]

# - name: Install backup tools
#   become: true
#   community.general.packaging.os.pacman:
#     name:
#       - borg
#       - restic

# - name: Install pulseaudio
#   become: true
#   community.general.packaging.os.pacman:
#     name:
#       - pulseaudio
#       - pulseaudio-alsa
#       - pulseaudio-zeroconf
#       - paprefs
#       - pamixer
#       - pulsemixer

- name: Install pipewire
  become: true
  community.general.packaging.os.pacman:
    name:
      - pamixer
      - paprefs
      - pipewire
      - pipewire-alsa
      - pipewire-jack
      - pipewire-pulse
      - pipewire-v4l2
      - pipewire-zeroconf
      - pulsemixer

# - name: Install alsa
#   become: true
#   community.general.packaging.os.pacman:
#     name: [alsa-utils, alsa-plugins]
#    # alsa-tools
#    # amixer sset Master    unmute
#    # amixer sset Speaker   unmute
#    # amixer sset Headphone unmute
#    # alsamixer
#    # speaker-test -c 2

- name: Install bluetooth
  become: true
  community.general.packaging.os.pacman:
    name: [bluez]
    # name: [bluez-cups, bluez-utils, pulseaudio-bluetooth]

- name: Enable bluetooth services
  become: true
  ansible.builtin.service:
    name: bluetooth
    enabled: true

- name: Enable search service
  become: true
  ansible.builtin.service:
    name: updatedb.timer
    enabled: true

# - name: Clean unnecessary packages
#   become: true
#   community.general.packaging.os.pacman:
#     state: absent
#     name: []

# - name: Allow RSYNC for new super user without SUDO password
#   become: true
#   ansible.builtin.lineinfile:
#     path: /etc/sudoers
#     state: present
#     insertafter: ^%sudo
#     line: "{{ lookup('env','USER') }} ALL=NOPASSWD: /usr/bin/rsync"

- name: Copy configs
  become: true
  ansible.posix.synchronize:
    src: etc
    dest: /
    archive: false
    compress: false
    recursive: true

# - name: Disallow RSYNC for new super user without SUDO password
#   become: true
#   ansible.builtin.lineinfile:
#     path: /etc/sudoers
#     state: absent
#     line: "{{ lookup('env','USER') }} ALL=NOPASSWD: /usr/bin/rsync"

- name: Enable reflector service
  become: true
  ansible.builtin.service:
    name: reflector.timer
    enabled: true
