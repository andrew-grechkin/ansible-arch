---
- name: Install filesystem/partition tools
  become: true
  community.general.pacman:
    name: [btrfs-progs, dosfstools, ntfs-3g, udftools]

- name: Install search tools
  become: true
  community.general.pacman:
    name: [mlocate]

- name: Install boot tools
  become: true
  community.general.pacman:
    name: [efibootmgr]

- name: Install hdd tools
  become: true
  community.general.pacman:
    name: [smartmontools, hdparm]
    # - hd-idle

- name: Enable hdd smart service
  become: true
  ansible.builtin.service:
    name: smartd
    enabled: true

- name: Install common tools
  become: true
  community.general.pacman:
    name: [hwinfo, iotop, lsb-release, usbutils]

- name: Install network tools
  become: true
  community.general.pacman:
    name: [cifs-utils, inetutils, iw, nfs-utils, nss-mdns, sshfs, wireless-regdb]

- name: Install pacman tools
  become: true
  community.general.pacman:
    name: [pacman-contrib, pkgstats, reflector]

# => -------------------------------------------------------------------------------------------------------------- {{{1

- name: Install compression tools
  become: true
  community.general.pacman:
    name: [cpio, lzop, p7zip, unrar, unzip]

# - name: Install backup tools
#   become: true
#   community.general.pacman:
#     name:
#       - borg
#       - restic

- name: Install pipewire
  become: true
  community.general.pacman:
    name:
      - pamixer
      - paprefs
      - pipewire-alsa
      - pipewire-jack
      - pipewire-pulse
      - pipewire-v4l2
      - pipewire-zeroconf
      - pulsemixer

# - name: Install alsa
#   become: true
#   community.general.pacman:
#     name: [alsa-utils, alsa-plugins]
#    # alsa-tools
#    # amixer sset Master    unmute
#    # amixer sset Speaker   unmute
#    # amixer sset Headphone unmute
#    # alsamixer
#    # speaker-test -c 2

- name: Install bluetooth
  become: true
  community.general.pacman:
    name: [bluez, bluez-utils]
    # name: [bluez-cups, bluez-utils, pulseaudio-bluetooth]

- name: Enable bluetooth services
  become: true
  ansible.builtin.service:
    name: bluetooth
    enabled: true

- name: Enable search service
  become: true
  ansible.builtin.service:
    name: updatedb.timer
    enabled: true

# - name: Clean unnecessary packages
#   become: true
#   community.general.pacman:
#     state: absent
#     name: []

# - name: Allow RSYNC for new super user without SUDO password
#   become: true
#   ansible.builtin.lineinfile:
#     path: /etc/sudoers
#     state: present
#     insertafter: ^%sudo
#     line: "{{ lookup('env','USER') }} ALL=NOPASSWD: /usr/bin/rsync"

- name: Copy configs
  become: true
  ansible.posix.synchronize:
    src: etc
    dest: /
    archive: false
    compress: false
    recursive: true

# - name: Disallow RSYNC for new super user without SUDO password
#   become: true
#   ansible.builtin.lineinfile:
#     path: /etc/sudoers
#     state: absent
#     line: "{{ lookup('env','USER') }} ALL=NOPASSWD: /usr/bin/rsync"

- name: Enable reflector service
  become: true
  ansible.builtin.service:
    name: reflector.timer
    enabled: true
