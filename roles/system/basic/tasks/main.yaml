---
- name: Install essential tools
  become: true
  community.general.pacman:
    name: [bash-completion, git, neovim, polkit, sudo, tmux, zsh-completions]

- name: Install filesystem/partition tools
  become: true
  community.general.pacman:
    name: [btrfs-progs, dosfstools, fuseiso, ntfs-3g, sshfs, udftools]

- name: Install man/help
  become: true
  community.general.pacman:
    name: [man-db, man-pages]

- name: Install search tools
  become: true
  community.general.pacman:
    name: [fd, fzf, mlocate, ripgrep, the_silver_searcher]

- name: Install boot tools
  become: true
  community.general.pacman:
    name: [efibootmgr, refind]

- name: Install hdd tools
  become: true
  community.general.pacman:
    name: [smartmontools, hdparm]
    # - hd-idle

- name: Enable hdd smart service
  become: true
  ansible.builtin.service:
    name: smartd
    enabled: true

- name: Install common tools
  become: true
  community.general.pacman:
    name: [eza, htop, hwinfo, iotop, lsb-release, lsof, moreutils, strace, usbutils]

- name: Install network tools
  become: true
  community.general.pacman:
    name: [cifs-utils, gnu-netcat, inetutils, iw, nfs-utils, nss-mdns, rsync, socat, wireless-regdb]

- name: Install pacman tools
  become: true
  community.general.pacman:
    name: [pacman-contrib, pkgstats, reflector]

# => -------------------------------------------------------------------------------------------------------------- {{{1

- name: Install perl base
  become: true
  community.general.pacman:
    name: [perlbrew]

- name: Install perl additional
  become: true
  community.general.pacman:
    name:
      - perl-cpanel-json-xs
      - perl-data-dump
      - perl-datetime-timezone
      - perl-dbd-pg
      - perl-ev
      - perl-image-exiftool
      - perl-io-socket-ssl
      - perl-log-any
      - perl-path-tiny
      - perl-perl-critic
      - perl-rename
      - perl-role-tiny
      - perl-tidy
      - perl-yaml-libyaml

- name: Install python base
  become: true
  community.general.pacman:
    name: [pyenv, python, python-neovim, swig]

# => -------------------------------------------------------------------------------------------------------------- {{{1

- name: Install compression tools
  become: true
  community.general.pacman:
    name: [cpio, lzop, p7zip, unrar, unzip]

- name: Install file management tools
  become: true
  community.general.pacman:
    name: [inotify-tools, jq, ncdu, parallel, pigz, progress, pv, vifm]

- name: Install barcode/qrcode tools
  become: true
  community.general.pacman:
    name: [zbar]

# - name: Install backup tools
#   become: true
#   community.general.pacman:
#     name:
#       - borg
#       - restic

- name: Install pipewire
  become: true
  community.general.pacman:
    name:
      - pamixer
      - paprefs
      - pipewire-alsa
      - pipewire-jack
      - pipewire-pulse
      - pipewire-v4l2
      - pipewire-zeroconf
      - pulsemixer

# - name: Install alsa
#   become: true
#   community.general.pacman:
#     name: [alsa-utils, alsa-plugins]
#    # alsa-tools
#    # amixer sset Master    unmute
#    # amixer sset Speaker   unmute
#    # amixer sset Headphone unmute
#    # alsamixer
#    # speaker-test -c 2

- name: Install bluetooth
  become: true
  community.general.pacman:
    name: [bluez, bluez-utils]
    # name: [bluez-cups, bluez-utils, pulseaudio-bluetooth]

- name: Enable bluetooth services
  become: true
  ansible.builtin.service:
    name: bluetooth
    enabled: true

- name: Enable search service
  become: true
  ansible.builtin.service:
    name: updatedb.timer
    enabled: true

# - name: Clean unnecessary packages
#   become: true
#   community.general.pacman:
#     state: absent
#     name: []

# - name: Allow RSYNC for new super user without SUDO password
#   become: true
#   ansible.builtin.lineinfile:
#     path: /etc/sudoers
#     state: present
#     insertafter: ^%sudo
#     line: "{{ lookup('env','USER') }} ALL=NOPASSWD: /usr/bin/rsync"

- name: Copy configs
  become: true
  ansible.posix.synchronize:
    src: etc
    dest: /
    archive: false
    compress: false
    recursive: true

# - name: Disallow RSYNC for new super user without SUDO password
#   become: true
#   ansible.builtin.lineinfile:
#     path: /etc/sudoers
#     state: absent
#     line: "{{ lookup('env','USER') }} ALL=NOPASSWD: /usr/bin/rsync"

- name: Enable reflector service
  become: true
  ansible.builtin.service:
    name: reflector.timer
    enabled: true
